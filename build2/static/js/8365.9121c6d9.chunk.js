"use strict";(self.webpackChunkmantis_free_react_admin_template=self.webpackChunkmantis_free_react_admin_template||[]).push([[8365],{938365:(e,t,s)=>{s.r(t),s.d(t,{default:()=>v});var i=s(747313),n=s(582138),a=s(650877),o=s(531669),r=s(809019),l=s(261113),c=s(258467),d=s(118197),u=s(999519),m=s(948935),p=s(536287),h=s(636671),g=s(576733),x=s.n(g),j=s(346417);const v=()=>{const[e,t]=(0,i.useState)(!1),[s,g]=(0,i.useState)(!1),[v,_]=(0,i.useState)(""),[f,b]=(0,i.useState)(""),[P,y]=(0,i.useState)([]),E=(0,c.s0)(),N=(0,c.TH)().state;console.log(N,"userRecord");const[S,Z]=(0,i.useState)(),[w,I]=(0,i.useState)([]);console.log("updData",S),console.log("imgList",P),console.log("base64Img",w);const[C,T]=(0,i.useState)({title:"",location:"",description:"",price:0});(0,i.useEffect)((()=>{1!=(null===N||void 0===N?void 0:N._id)&&B()}),[null===N||void 0===N?void 0:N._id]),(0,i.useEffect)((()=>{null!==S&&void 0!==S&&S.title?T({...C,title:S.title,location:S.location,description:S.description,price:S.price}):T({...C,title:"",location:"",description:"",price:0})}),[S]);(0,i.useEffect)((()=>{setTimeout((()=>{if(P.length>0){const e=P.map((e=>null!==e&&void 0!==e&&e.thumbUrl&&"string"===typeof e.thumbUrl?e.thumbUrl.split(",")[1]:void console.error("Invalid thumbUrl:",null===e||void 0===e?void 0:e.thumbUrl)));I(e.filter((e=>void 0!==e)))}}),1e3)}),[P]),(0,i.useEffect)((()=>{if(S){var e;const t=null===S||void 0===S||null===(e=S.images)||void 0===e?void 0:e.map((async(e,t)=>{const s=await U(e);return{uid:"-1-".concat(t),name:"image".concat(t+1,".png"),status:"done",url:s,thumbUrl:s}}));Promise.all(t).then((e=>y(e)))}}),[S]);const U=async e=>{const t=await fetch(e),s=await t.blob();return new Promise((e=>{const t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(s)}))},W=(0,j.jsxs)("div",{children:[(0,j.jsx)(n.Z,{}),(0,j.jsx)("div",{style:{marginTop:8},children:"Upload img"})]}),[A,M]=(0,i.useState)(0),k=e=>{T({...C,[e.target.name]:e.target.value})},[L,R]=(0,i.useState)({title:"",location:"",description:"",price:"",img:""}),{title:F,location:H,description:G,price:q,img:D}=L;(0,i.useEffect)((()=>{!0===F&&!0===H&&!0===G&&!0===q&&!0===D&&(1!=(null===N||void 0===N?void 0:N._id)?Y():X())}),[A,F,H,G,q]);const X=async()=>{t(!0);const e=w.filter((e=>void 0!==e)),s={...C,images:e};try{200==(await d.b.post("/user/createProduct",s)).status?((0,u.dr)("Product Created SuccessFully !!"),t(!1),E("/user/market-place-list")):((0,u.YE)("Something Wen't Wrong !!"),t(!1))}catch(L){console.log(L),t(!1),(0,u.YE)("Something Wen't Wrong !!")}},Y=async()=>{t(!0);const e=w.filter((e=>void 0!==e)),s={...C,images:e};console.log("paramas",s);try{200==(await d.b.post("/user/updateProduct/".concat(null===N||void 0===N?void 0:N._id),s,{headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.jwt)}})).status?((0,u.dr)("Product Updated SuccessFully !!"),E("/product"),E("".concat(p.ZP.basename,"/product")),t(!1)):((0,u.YE)("Something Wen't Wrong !!"),t(!1))}catch(L){console.log(L),t(!1),(0,u.YE)("Something Wen't Wrong !!")}},B=async()=>{try{fetch("".concat(p.ZP.url,"/user/getProductById/").concat(null===N||void 0===N?void 0:N._id),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.jwt)}}).then((e=>e.json())).then((e=>{200==e.status?Z(null===e||void 0===e?void 0:e.getProduct):(0,u.YE)("Something Wen't Wrong !!")}))}catch(L){console.log(L)}};return(0,j.jsx)("div",{children:(0,j.jsxs)(r.ZP,{container:!0,children:[(0,j.jsx)(r.ZP,{item:!0,xs:12,sx:{mt:7.25},children:(0,j.jsx)(l.Z,{variant:"h5",className:"global_top_head",children:(0,j.jsx)("h2",{className:"top_heading_pages_text",children:"Update Market Place"})})}),(0,j.jsx)(r.ZP,{container:!0,spacing:2,children:(0,j.jsx)(r.ZP,{item:!0,xl:12,lg:12,md:12,children:(0,j.jsxs)("div",{className:"product_upload_img top_box",children:[(0,j.jsx)(r.ZP,{container:!0,sx:{justifyContent:"center"},children:(0,j.jsxs)(r.ZP,{xs:6,children:[(0,j.jsxs)("div",{className:"upload_images text-center",children:[(0,j.jsx)(o.Z,{action:"https://run.mocky.io/v3/435e224c-44fb-4773-9faf-380c5e6a2188",listType:"picture-circle",fileList:P,onPreview:async e=>{_(e.url||e.preview),g(!0),b(e.name||e.url.substring(e.url.lastIndexOf("/")+1))},beforeUpload:e=>{const t=e.size/1024<=MAX_FILE_SIZE;return t?e.type&&e.type.startsWith("image/")?new Promise(((t,s)=>{const i=new Image;i.src=URL.createObjectURL(e),i.onload=()=>{i.width<=MAX_IMAGE_WIDTH&&i.height<=MAX_IMAGE_HEIGHT?t(!0):(a.Z.error({title:"Image dimensions must be less than ".concat(MAX_IMAGE_WIDTH,"x").concat(MAX_IMAGE_HEIGHT," pixels!")}),s(!1))},i.onerror=()=>{s(!1)}})):t:(a.Z.error({title:"File must be smaller than 500KB!"}),!1)},onChange:e=>{y(e.fileList)},children:P.length>=8?null:W}),(0,j.jsx)(a.Z,{open:s,title:f,footer:null,onCancel:()=>g(!1),children:(0,j.jsx)("img",{alt:"example",style:{width:"100%"},src:v})})]}),(0,j.jsx)("span",{className:"errmsg",children:L.img})]})}),(0,j.jsxs)(r.ZP,{container:!0,spacing:2,className:"mt-5",children:[(0,j.jsx)(r.ZP,{item:!0,xl:4,lg:4,md:4,sm:6,xs:12,children:(0,j.jsxs)("div",{className:"group  error",children:[(0,j.jsx)("input",{className:"inputMaterial",type:"text",name:"title",onChange:k,placeholder:"Enter your Product Tittle",value:C.title}),(0,j.jsx)("span",{className:"bar"}),(0,j.jsx)("label",{htmlFor:"first",children:"Tittle"}),(0,j.jsx)("span",{className:"errmsg",children:L.title})]})}),(0,j.jsx)(r.ZP,{item:!0,xl:4,lg:4,md:4,sm:6,xs:12,children:(0,j.jsxs)("div",{className:"location_search group error",children:[(0,j.jsx)(m.ZP,{value:C.location,name:"location",onChange:e=>{T((t=>({...t,location:e})))},onSelect:async e=>{try{T((t=>({...t,location:e})))}catch(L){console.error("Error selecting address",L)}},children:e=>{let{getInputProps:t,suggestions:s,getSuggestionItemProps:n,loading:a}=e;return(0,j.jsxs)("div",{className:"location_input",children:[(0,j.jsx)("span",{className:"top_text",children:"Location"}),(0,j.jsx)("input",{...t({placeholder:"Type address"})}),(0,j.jsxs)("div",{className:"autocomplete-dropdown-container",children:[a?(0,j.jsx)("div",{children:"Loading..."}):null,null===s||void 0===s?void 0:s.map((e=>{const t={backgroundColor:e.active?"whitesmoke":"#fff",padding:"10px 10px",cursor:"pointer"};return(0,i.createElement)("div",{...n(e,{style:t}),key:e.placeId},e.description)}))]})]})}}),(0,j.jsx)("span",{className:"errmsg",children:L.location})]})}),(0,j.jsx)(r.ZP,{item:!0,xl:4,lg:4,md:4,sm:6,xs:12,children:(0,j.jsxs)("div",{className:"group  error",children:[(0,j.jsx)("input",{className:"inputMaterial",value:C.price,name:"price",type:"text",maxLength:5,onChange:k,placeholder:"Enter Price"}),(0,j.jsx)("span",{className:"bar"}),(0,j.jsx)("label",{htmlFor:"first",children:"Price"}),(0,j.jsx)("span",{className:"errmsg",children:L.price})]})}),(0,j.jsx)(r.ZP,{item:!0,xl:12,lg:12,md:12,sm:12,xs:12,children:(0,j.jsx)(h.CKEditor,{editor:x(),data:C.description,onChange:(e,t)=>{const s=t.getData();T((e=>({...e,description:s})))}})}),(0,j.jsx)(r.ZP,{item:!0,xl:12,lg:12,md:12,sm:12,xs:12,className:"text-end",children:e?(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("button",{className:"global_btn",children:[(0,j.jsx)("div",{className:"spinner-border spinner-border-sm me-1",role:"status"})," Loading ..."]})}):(0,j.jsx)("button",{className:"global_btn",onClick:()=>{M(A+1),""==C.title.trim()?R((e=>({...e,title:"Required *"}))):R((e=>({...e,title:!0}))),0==w.length?R((e=>({...e,img:"Required *"}))):R((e=>({...e,img:!0}))),""==C.location.trim()?R((e=>({...e,location:"Required *"}))):R((e=>({...e,location:!0}))),""==C.description.trim()?R((e=>({...e,description:"Required *"}))):R((e=>({...e,description:!0}))),""==C.price?R((e=>({...e,price:"Required *"}))):/^[0-9]*$/.test(C.price)?R((e=>({...e,price:!0}))):R((e=>({...e,price:"Enter Valid Price "})))},children:1!=(null===N||void 0===N?void 0:N._id)?"Update Product":"Publish"})})]})]})})})]})})}}}]);